version: '3'

services:
  fit-demo-arserver:
    image: arcor2/arcor2_arserver:0.21.0
    container_name: fit-demo-arserver
    depends_on:
      - fit-demo-project
      - fit-demo-build
      - fit-demo-execution
      - fit-demo-kinect
      - fit-demo-mocks
      - fit-demo-calibration
    ports:
      - "6789:6789"
    networks:
          - fit-demo-kinect-network
          - fit-demo-robot-network
          - fit-demo-project-network
          - fit-demo-dobot-network
          - fit-demo-calibration-network
    environment:
      - ARCOR2_PROJECT_SERVICE_URL=http://fit-demo-project:10000
      - ARCOR2_SCENE_SERVICE_URL=http://fit-demo-mocks:5013
      - ARCOR2_EXECUTION_URL=ws://fit-demo-execution:6790
      - ARCOR2_BUILD_URL=http://fit-demo-build:5008
      - ARCOR2_CALIBRATION_URL=http://fit-demo-calibration:5014

  fit-demo-build:
    image: arcor2/arcor2_build:0.20.0
    container_name: fit-demo-build
    depends_on:
      - fit-demo-project
    environment:
      - ARCOR2_PROJECT_SERVICE_URL=http://fit-demo-project:10000
    ports:
      - "5008:5008"
    networks:           
      - fit-demo-project-network

  fit-demo-execution:
    image: arcor2/arcor2_execution:0.18.0
    container_name: fit-demo-execution
    networks:
      - fit-demo-execution-network
      - fit-demo-robot-network
      - fit-demo-dobot-network
    environment:
      - ARCOR2_SCENE_SERVICE_URL=http://fit-demo-mocks:5013
      - ARCOR2_PROJECT_PATH=/root/project
    volumes:
        - fit-demo-execution:/root/project

  fit-demo-kinect:
    image: arcor2/arcor2_kinect_azure:0.3.0
    container_name: fit-demo-kinect
    networks:
      - fit-demo-kinect-network
    ports:
        - "5016:5016"
    environment:
      - ARCOR2_KINECT_AZURE_MOCK=true

  fit-demo-calibration:
    image: arcor2/arcor2_calibration:0.6.1
    networks:
      - fit-demo-calibration-network
    ports:
      - "5014:5014"
    environment:
      - ARCOR2_CALIBRATION_URL=http://fit-demo-calibration:5014
      - ARCOR2_CALIBRATION_MOCK=false
    volumes:
      - ./calibration.yaml:/root/calibration.yaml

  fit-demo-dobot:
    image: arcor2/arcor2_dobot:0.2.3
    container_name: fit-demo-dobot
    networks:
      - fit-demo-dobot-network
    ports:
        - "5018:5018"
    environment:
      - ARCOR2_DOBOT_MOCK=true

  fit-demo-dobot2:
    image: arcor2/arcor2_dobot:0.2.3
    container_name: fit-demo-dobot2
    networks:
      - fit-demo-dobot-network
    ports:
        - "5019:5018"
    environment:
      - ARCOR2_DOBOT_MOCK=true

  fit-demo-dobot3:
    image: arcor2/arcor2_dobot:0.2.3
    container_name: fit-demo-dobot3
    networks:
      - fit-demo-dobot-network
    ports:
        - "5120:5018"
    environment:
      - ARCOR2_DOBOT_MOCK=true

  fit-demo-mocks:
    image: arcor2/arcor2_mocks:0.16.0
    container_name: fit-demo-mocks
    networks:
          - fit-demo-robot-network
    ports:
      - "5013:5013"

  fit-demo-project:
    image: registry.gitlab.com/kinalisoft/test-it-off/project:0.13.0
    container_name: "fit-demo-project"
    ports:
      - "10000-10001:10000-10001"
    environment:
      MONGODB_URL: fit-demo-project-mongodb:27017
    links:
        - fit-demo-project-mongodb
    depends_on:
        - fit-demo-project-mongodb
    networks:
      - fit-demo-project-network
    volumes:
      - fit-demo-project-resources:/data/resources

  fit-demo-project-mongodb:
    image: mongo:4.2.15-bionic
    container_name: "fit-demo-project-mongodb"
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    volumes:
      - fit-demo-project-mongodb:/data/db
    expose:
      - "27017"
    networks:
      - fit-demo-project-network

  fit-demo-nginx:
    image: nginx:1.21.1
    container_name: "fit-demo-nginx"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    ports:
      - "6790:80"
    networks:
      - fit-demo-project-network
    depends_on:
      - fit-demo-project

volumes:
  fit-demo-project-resources:
  fit-demo-project-mongodb:
  fit-demo-execution:
  fit-demo-robotsystem-mongodb:

networks:
  fit-demo-robot-network:
  fit-demo-execution-network:
  fit-demo-project-network:
  fit-demo-kinect-network:
  fit-demo-dobot-network:
  fit-demo-calibration-network: